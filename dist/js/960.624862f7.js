"use strict";(self["webpackChunkbiyeshiji"]=self["webpackChunkbiyeshiji"]||[]).push([[960],{231:function(e,t,a){a.d(t,{Z:function(){return c}});var o=a(3396),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"unordered-list",theme:"outlined"},l=s,r=a(8144);function n(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},o=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),o.forEach((function(t){i(e,t,a[t])}))}return e}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var u=function(e,t){var a=n({},e,t.attrs);return(0,o.Wm)(r.Z,n({},a,{icon:l}),null)};u.displayName="UnorderedListOutlined",u.inheritAttrs=!1;var c=u},3171:function(e,t,a){a.d(t,{Z:function(){return g}});var o=a(3396),s=a(7139),l=a(4870),r=a(240),n=a(2315),i=a(1094),u=a(269);const c={class:"sidebar"},d=["src"],b={style:{"margin-left":"5px"}};var m=(0,o.aZ)({__name:"SideBar",props:{url:{type:String,require:!0}},setup(e){const t=e,a=(0,l.iH)([{id:1,text:"图书预约",url:"/bookmanage",selected:!1,image:r},{id:2,text:"用户信息",url:"/user",selected:!1,image:n},{id:3,text:"图书借阅",url:"/borrow",selected:!1,image:i},{id:4,text:"我的通知",url:"/notice",selected:!1,image:u}]);return(0,o.wF)((()=>{a.value.forEach((e=>{e.url===t.url&&(e.selected=!0)}))})),(e,t)=>{const l=(0,o.up)("router-link");return(0,o.wg)(),(0,o.iD)("div",c,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.value,((e,t)=>((0,o.wg)(),(0,o.iD)("div",{class:(0,s.C_)(["sideitem",{selected:e.selected}]),key:t},[(0,o.Wm)(l,{to:e.url},{default:(0,o.w5)((()=>[(0,o._)("div",{class:(0,s.C_)(["fonts",{selectedfont:e.selected}])},[(0,o._)("img",{src:e.image},null,8,d),(0,o._)("span",b,(0,s.zw)(e.text),1)],2)])),_:2},1032,["to"])],2)))),128))])}}}),p=a(89);const v=(0,p.Z)(m,[["__scopeId","data-v-0e72bda8"]]);var g=v},9809:function(e,t,a){a.d(t,{Z:function(){return Y}});var o=a(3396),s=a(4870),l=a(7139),r=a(6949),n=a(789),i=a(9722),u=a(1076),c=a(65),d=a(2074),b=a(2876),m=a(2002),p=a(6418);const v=e=>((0,o.dD)("data-v-82e46dfe"),e=e(),(0,o.Cn)(),e),g={class:"topmenu",style:{position:"relative"}},w=v((()=>(0,o._)("div",{class:"logo"},[(0,o._)("img",{src:r})],-1))),f={style:{position:"absolute",width:"60%",height:"80%","margin-left":"20%"}},h={style:{display:"flex","flex-direction":"row","justify-content":"center","align-items":"center"}},k={class:"user-info"},y={class:"avatar"},_=["src"],Z={key:1,src:n},x=v((()=>(0,o._)("img",{style:{width:"35px",height:"35px"},src:i},null,-1))),S=[x];var D=(0,o.aZ)({__name:"TopMenu",emits:["enterFullscreen","exitFullscreen","reload"],setup(e,{emit:t}){const a=t;let r=(0,s.iH)(!1),n=(0,s.iH)([]);const i=()=>{a("enterFullscreen"),r.value=!0},v=()=>{a("exitFullscreen"),r.value=!1},x=()=>{a("reload")},D=(0,c.oR)(),F=async()=>{const{data:e}=await u.Z.get("http://localhost:3000/shownotices?userId="+D.state.user._id),t=e.notices.filter((e=>0===e.status));n.value=t};(0,o.wF)((async()=>{await F();const e=3e4;setInterval((async()=>{await F()}),e)}));const W=()=>{d.ZP.loading("loading",1).then((()=>{localStorage.removeItem("user"),D.commit("logout"),D.commit("setLoginStatus",!1)}))};return(e,t)=>{const a=(0,o.up)("a-tag"),u=(0,o.up)("a-carousel");return(0,o.wg)(),(0,o.iD)("div",g,[w,(0,o._)("div",f,[(0,o.Wm)(u,{autoplay:"",dots:!1,effect:"fade"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)((0,s.SU)(n),((e,t)=>((0,o.wg)(),(0,o.iD)("div",{key:t},[(0,o._)("h2",h,[(0,o.Wm)(a,{color:e.title.includes("归还")||e.title.includes("借阅")?"green":"通知"===e.tag?"red":"公告"===e.tag?"blue":"warning"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(e.tag),1)])),_:2},1032,["color"]),(0,o.Uk)((0,l.zw)(e.content.length>50?e.content.slice(0,30)+"...":e.content),1)])])))),128))])),_:1})]),(0,o._)("div",k,[(0,o.Wm)((0,s.SU)(b.Z),{onClick:x,style:{fontSize:"21px",marginRight:"3px"}}),(0,s.SU)(r)?((0,o.wg)(),(0,o.j4)((0,s.SU)(p.Z),{key:1,style:{fontSize:"21px",marginRight:"3px"},onClick:v})):((0,o.wg)(),(0,o.j4)((0,s.SU)(m.Z),{key:0,style:{fontSize:"21px",marginRight:"3px"},onClick:i})),(0,o._)("div",y,[(0,s.SU)(D).state.user.avatar?((0,o.wg)(),(0,o.iD)("img",{key:0,src:(0,s.SU)(D).state.user.avatar},null,8,_)):((0,o.wg)(),(0,o.iD)("img",Z)),(0,o._)("span",null,(0,l.zw)((0,s.SU)(D).state.user.username),1)]),(0,o._)("div",{class:"user-btn",onClick:W},S)])])}}}),F=a(89);const W=(0,F.Z)(D,[["__scopeId","data-v-82e46dfe"]]);var Y=W},1485:function(e,t,a){a.r(t),a.d(t,{default:function(){return z}});a(560);var o=a(3396),s=a(9242),l=a(4870),r=a(7139),n=a(3171),i=a(9809),u=a(5743),c=a.n(u),d=a(2483),b=a(1076),m=a(65),p=a(2074),v=a(231),g=a(2876),w=a(8822);const f={key:0,style:{width:"100vw",height:"100vh"}},h={key:1,class:"borrow-page"},k={class:"main-content"},y={class:"borrowform"},_={key:1,class:"card-container"},Z={key:2,class:"card-container"},x={class:"scroll-container"},S={class:"scroll-content"},D=["src"],F={class:"borrow-table"},W={key:1};var Y=(0,o.aZ)({__name:"BorrowBook",setup(e){const t=(0,m.oR)(),a=(0,l.iH)(),u=(0,l.iH)(!0),Y=(0,l.iH)(!0),I=(0,l.iH)([]),U=async e=>{console.log("bookid",e),u.value=!1,setTimeout((async()=>{Y.value=!1,e?await b.Z.get("http://localhost:3000/getbookprebyid?bookId="+e).then((e=>{200===e.status&&(I.value=JSON.parse(e.data.preview.replace(/'/g,'"')))})):await b.Z.get("http://localhost:3000/getbookprebyisbn?isbn="+q.isbn).then((e=>{200===e.status&&(I.value=JSON.parse(e.data.preview.replace(/'/g,'"')))}))}),1e3)},z={span:7},H={span:15},R=(0,l.iH)("1"),q=(0,l.qj)({bookName:"",date1:void 0,isbn:"",id:""});let C=(0,l.iH)([{status:"已预约",color:"green"},{status:"已归还",color:"geekblue"},{status:"已逾期",color:"volcano"},{status:"借阅中",color:"cyan"}]);const P=()=>{const e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},M=()=>{document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},N=(0,l.iH)(!1),j=async()=>{try{N.value=!0,await b.Z.get("http://localhost:3000/showborrowlist?userId="+t.state.user._id).then((async e=>{if(e){const t=[];for(let a=0;a<e.data.records.length;a++)0===e.data.records[a].status&&t.push(e.data.records[a]);for(let e=0;e<t.length;e++)c()(t[e].backAt).isBefore(c()())&&await b.Z.post("http://localhost:3000/updateborrow",{record:t[e]});$("init")}})).finally((()=>{N.value=!1}))}catch(e){console.log(e)}},O=(0,d.tv)();let A=(0,l.iH)([]);const E=(0,l.iH)(!0);(0,o.wF)((async()=>{q.bookName=O.currentRoute.value.query.bookname?.toString(),q.isbn=O.currentRoute.value.query.isbn?.toString(),q.id=O.currentRoute.value.query.id?.toString(),E.value=!1,N.value=!0,await b.Z.get("http://localhost:3000/showborrowlist?userId="+t.state.user._id).then((async e=>{if(e){const t=[];for(let a=0;a<e.data.records.length;a++)0===e.data.records[a].status&&t.push(e.data.records[a]);for(let e=0;e<t.length;e++)c()(t[e].backAt).isBefore(c()())&&await b.Z.post("http://localhost:3000/updateborrow",{record:t[e]});$("init")}})).finally((()=>{N.value=!1}))}));const B=()=>{try{E.value=!0,setTimeout((async()=>{const{data:e}=await b.Z.get("http://localhost:3000/showborrowlist?userId="+t.state.user._id),a=[];for(let t=0;t<e.records.length;t++)0===e.records[t].status&&a.push(e.records[t]);for(let t=0;t<a.length;t++)console.log("test1",e.records[t].status),c()(a[t].backAt).isBefore(c()())&&await b.Z.post("http://localhost:3000/updateborrow",{record:a[t]});$("init"),E.value=!1}),1e3)}catch(e){console.log(e)}},K=[{title:"书名",dataIndex:"bookname",width:150},{title:"ISBN",dataIndex:"isbn",width:150},{title:"借阅人",dataIndex:"bperson",width:100},{title:"借阅日期",dataIndex:"borrowtime",width:150},{title:"还书日期",dataIndex:"backtime",width:150},{title:"状态",dataIndex:"status",width:100}],T=async e=>{if(console.log("ffff",q),V.value=!0,"借阅"===e)try{if(G(q.id,void 0))p.ZP.error("这本书你已经预约或借过了",1.5),V.value=!1;else{let e;if(O.currentRoute.value.query.id)e={book:O.currentRoute.value.query.id,backAt:a.value.getFieldsValue().date1.$d,isbn:q.isbn,user:t.state.user._id},console.log("record:",e),await b.Z.post("http://localhost:3000/addborrow",{record:e,haveId:!0}),$("update");else{e={backAt:a.value.getFieldsValue().date1.$d,isbn:q.isbn,user:t.state.user._id};const{data:o}=await b.Z.get("http://localhost:3000/showborrowlist?userId="+t.state.user._id);let s;o.records.forEach((e=>{s=e.book.isbn.toString()===q.isbn&&(0===e.status||2===e.status)})),s?(p.ZP.error("这本书你已经预约或借过了",1),V.value=!1):(await b.Z.post("http://localhost:3000/addborrow",{record:e,haveId:!1}),$("update"))}}}catch(o){console.log("error",o),p.ZP.error("请检查所填信息是否正确",1.5)}else if("还书"===e)if(G(void 0,q.isbn)){const e={isbn:q.isbn,user:t.state.user._id,status:1},{data:a}=await b.Z.post("http://localhost:3000/addback",{record:e});$("back")}else p.ZP.error("未查到借阅信息",1)},J=e=>{console.log("e",typeof e),"2"===e?(a.value.resetFields(),q.bookName="",q.isbn=""):(q.isbn=O.currentRoute.value.query.isbn?.toString()||"",q.bookName=O.currentRoute.value.query.bookname?.toString()||"")},L=()=>{console.log("重置了"),a.value.resetFields(),q.bookName="",q.isbn=""},V=(0,l.iH)(!1),$=async e=>{try{const{data:a}=await b.Z.get("http://localhost:3000/showborrowlist?userId="+t.state.user._id);"init"===e?(console.log("status",C.value[0]),A.value=[...a.records].map(((e,t)=>({key:t,id:e.book._id,bookname:e.book.bookname,isbn:e.book.isbn,bperson:e.user.username,borrowtime:c()(e.createdAt).format("YYYY-MM-DD"),backtime:c()(e.backAt).format("YYYY-MM-DD"),status:C.value[e.status]}))),V.value=!1):"update"===e?p.ZP.loading("loading..",1.5).then((()=>p.ZP.success("预约成功",1))).then((()=>{O.push("/borrow"),A.value=[...a.records].map(((e,t)=>({key:t,bookname:e.book.bookname,isbn:e.book.isbn,bperson:e.user.username,borrowtime:c()(e.createdAt).format("YYYY-MM-DD"),backtime:c()(e.backAt).format("YYYY-MM-DD"),status:C.value[e.status]}))),L(),V.value=!1})):"back"===e&&p.ZP.loading("loading..",1.5).then((()=>p.ZP.success("归还成功",1))).then((()=>{A.value=[...a.records].map(((e,t)=>({key:t,bookname:e.book.bookname,isbn:e.book.isbn,bperson:e.user.username,borrowtime:c()(e.createdAt).format("YYYY-MM-DD"),backtime:c()(e.backAt).format("YYYY-MM-DD"),status:C.value[e.status]}))),V.value=!1}))}catch(a){const e=a;p.ZP.loading("loading..",1).then((()=>p.ZP.error(e.response.data.errors[0].msg,2)))}},G=(e,t)=>{if(console.log("1122",e),console.log("22222",A.value),e){for(let a=0;a<A.value.length;a++)if(A.value[a].id===e&&"已归还"!==A.value[a].status.status)return!0}else for(let a=0;a<A.value.length;a++)if(A.value[a].isbn.toString()===t&&"已归还"!==A.value[a].status.status)return!0;return!1};return(e,t)=>{const c=(0,o.up)("a-button"),d=(0,o.up)("a-input"),b=(0,o.up)("a-form-item"),m=(0,o.up)("a-date-picker"),p=(0,o.up)("a-form"),C=(0,o.up)("a-tab-pane"),O=(0,o.up)("a-tabs"),$=(0,o.up)("a-spin"),G=(0,o.up)("a-tag"),Q=(0,o.up)("a-table"),X=(0,o.up)("a-float-button"),ee=(0,o.up)("a-float-button-group");return N.value?((0,o.wg)(),(0,o.iD)("div",f,[(0,o.Wm)(w.Z,{style:{display:"flex","justify-content":"center","align-items":"center"}})])):((0,o.wg)(),(0,o.iD)("div",h,[(0,o.Wm)(i.Z,{onEnterFullscreen:P,onExitFullscreen:M,onReload:j}),(0,o._)("div",k,[(0,o.Wm)(n.Z,{url:"/borrow"}),(0,o._)("div",y,[V.value?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"overlay",onClick:t[0]||(t[0]=(0,s.iM)((()=>{}),["stop"]))})):(0,o.kq)("",!0),u.value?((0,o.wg)(),(0,o.iD)("div",_,[(0,o.Wm)(c,{type:"primary",style:{position:"absolute",left:"42.5%",top:"13%","z-index":"999"},onClick:t[1]||(t[1]=e=>U(q.id)),disabled:!(q.bookName&&q.isbn&&q.date1)},{default:(0,o.w5)((()=>[(0,o.Uk)("在线预览")])),_:1},8,["disabled"]),(0,o.Wm)(O,{activeKey:R.value,"onUpdate:activeKey":t[6]||(t[6]=e=>R.value=e),type:"card",onChange:J},{default:(0,o.w5)((()=>[(0,o.Wm)(C,{key:"1",tab:"预约图书",style:{width:"50%"}},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{style:{width:"100%",height:"50%",margin:"50% 0 0 50%"},ref_key:"formRef",ref:a,model:q,"label-col":z,"wrapper-col":H},{default:(0,o.w5)((()=>[(0,o.Wm)(b,{ref:"bookName",label:"书名：",name:"bookName"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{value:q.bookName,"onUpdate:value":t[2]||(t[2]=e=>q.bookName=e)},null,8,["value"])])),_:1},512),(0,o.Wm)(b,{ref:"isbn",label:"ISBN：",name:"isbn"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{value:q.isbn,"onUpdate:value":t[3]||(t[3]=e=>q.isbn=e)},null,8,["value"])])),_:1},512),(0,o.Wm)(b,{label:"还书日期：",name:"date1"},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{value:q.date1,"onUpdate:value":t[4]||(t[4]=e=>q.date1=e),type:"date",placeholder:"Pick a date",style:{width:"100%"}},null,8,["value"])])),_:1}),(0,o.Wm)(b,{"wrapper-col":{span:14,offset:8}},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{type:"primary",disabled:!(q.bookName&&q.isbn&&q.date1),onClick:t[5]||(t[5]=e=>T("借阅"))},{default:(0,o.w5)((()=>[(0,o.Uk)("预约")])),_:1},8,["disabled"]),(0,o.Wm)(c,{style:{"margin-left":"50px"},onClick:L},{default:(0,o.w5)((()=>[(0,o.Uk)("重置")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1},8,["activeKey"])])):((0,o.wg)(),(0,o.iD)("div",Z,[(0,o.wy)((0,o.Wm)($,{style:{position:"absolute",top:"50%",left:"30%","z-index":"9999"}},null,512),[[s.F8,Y.value]]),(0,o.Wm)(c,{type:"primary",style:{position:"absolute",left:"42.5%",top:"13%","z-index":"999"},onClick:t[7]||(t[7]=e=>u.value=!0)},{default:(0,o.w5)((()=>[(0,o.Uk)("返回")])),_:1}),(0,o.wy)((0,o._)("div",x,[(0,o._)("div",S,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(I.value,((e,t)=>((0,o.wg)(),(0,o.iD)("div",{key:t,style:{width:"100%"}},[(0,o._)("img",{src:e,style:{width:"91%"}},null,8,D)])))),128))])],512),[[s.F8,!Y.value]])]))]),(0,o._)("div",F,[(0,o.Wm)(Q,{columns:K,"data-source":(0,l.SU)(A),pagination:{hideOnSinglePage:!0,pageSize:50},scroll:{y:700},loading:E.value},{bodyCell:(0,o.w5)((({text:e,column:t,record:a})=>["bookname"===t.dataIndex?((0,o.wg)(),(0,o.iD)(o.HY,{key:0},[(0,o.Uk)((0,r.zw)(e),1)],64)):"status"===t.dataIndex?((0,o.wg)(),(0,o.iD)("span",W,[(0,o.Wm)(G,{color:a.status.color},{default:(0,o.w5)((()=>[(0,o.Uk)((0,r.zw)(a.status.status),1)])),_:2},1032,["color"])])):(0,o.kq)("",!0)])),_:1},8,["data-source","loading"])])]),(0,o.Wm)(ee,{trigger:"hover",type:"primary",style:{right:"380px",bottom:"30px"}},{icon:(0,o.w5)((()=>[(0,o.Wm)((0,l.SU)(v.Z))])),default:(0,o.w5)((()=>[(0,o.Wm)(X,{onClick:B},{icon:(0,o.w5)((()=>[(0,o.Wm)((0,l.SU)(g.Z))])),_:1})])),_:1})]))}}}),I=a(89);const U=(0,I.Z)(Y,[["__scopeId","data-v-4c2dcc28"]]);var z=U}}]);
//# sourceMappingURL=960.624862f7.js.map