"use strict";(self["webpackChunkbiyeshiji"]=self["webpackChunkbiyeshiji"]||[]).push([[225],{5841:function(e,a,t){var l=t(1076);const r="http://localhost:3000",s=l.Z.create({baseURL:"/",timeout:1e3});s.interceptors.request.use((e=>(e.url=r+e.url,e)),(e=>Promise.reject(e))),a.Z=s},6820:function(e,a,t){t.r(a),t.d(a,{default:function(){return L}});t(560);var l=t(3396),r=t(4870),s=t(9242),o=t.p+"img/login-bg1.5d98771b.jpg",n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"}}]},name:"user",theme:"outlined"},u=n,i=t(8144);function c(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),l.forEach((function(a){m(e,a,t[a])}))}return e}function m(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var d=function(e,a){var t=c({},e,a.attrs);return(0,l.Wm)(i.Z,c({},t,{icon:u}),null)};d.displayName="UserOutlined",d.inheritAttrs=!1;var p=d,v={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"},g=v;function f(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),l.forEach((function(a){w(e,a,t[a])}))}return e}function w(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var h=function(e,a){var t=f({},e,a.attrs);return(0,l.Wm)(i.Z,f({},t,{icon:g}),null)};h.displayName="LockOutlined",h.inheritAttrs=!1;var y=h,b={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"}}]},name:"mail",theme:"outlined"},W=b;function _(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),l.forEach((function(a){P(e,a,t[a])}))}return e}function P(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var S=function(e,a){var t=_({},e,a.attrs);return(0,l.Wm)(i.Z,_({},t,{icon:W}),null)};S.displayName="MailOutlined",S.inheritAttrs=!1;var U=S,O=t(65),k=t(2483),Z=t(2074),j=t(5841);const x=e=>((0,l.dD)("data-v-2b6eff96"),e=e(),(0,l.Cn)(),e),F={class:"login-page"},q={class:"login"},z=x((()=>(0,l._)("img",{src:o},null,-1))),C={class:"login-wrapper"},H={key:0,class:"part1"},D={key:1,class:"part2"},M={key:2,class:"part3"};var I=(0,l.aZ)({__name:"LoginPage",setup(e){const a=(0,O.oR)(),t=(0,k.tv)();let o=(0,r.iH)("login"),n=(0,r.iH)(!1);const u=(0,r.iH)({email:"",captcha:"",password:"",confirm:""}),i=(0,r.iH)({username:"",password:"",remember:!0}),c=(0,r.iH)({email:"",captcha:"",username:"",password:""});(0,l.wF)((()=>{localStorage.getItem("user")&&(a.commit("setUser",JSON.parse(localStorage.getItem("user"))),i.value.remember=!0,i.value.username=JSON.parse(localStorage.getItem("user")).username,i.value.password=JSON.parse(localStorage.getItem("user")).password,Z.ZP.loading("loading..",2.5).then((()=>Z.ZP.success("登录成功",1.5))).then((()=>{console.log("1111",a.state.user.identity),0===a.state.user.identity?t.push({path:"/bookmanage"}):1===a.state.user.identity&&t.push({path:"/admin/bookmanage"})})))}));let m="";const d=(0,r.iH)(),v=async e=>{console.log("Success:",e);try{const{data:l}=await j.Z.post("/login",{user:{username:e.username,password:e.password}});console.log("data",l),console.log("user",l.user),e.remember?localStorage.setItem("user",JSON.stringify(l.user)):localStorage.removeItem("user"),a.commit("setUser",l.user),a.commit("setLoginStatus",!0),Z.ZP.loading("loading..",2.5).then((()=>Z.ZP.success("登录成功",1.5))).then((()=>{console.log("store.state.user.role.identity",a.state.user.role.identity),0===a.state.user.role.identity?t.push({path:"/bookmanage"}):1===a.state.user.role.identity&&t.push({path:"/admin/analysis"})}))}catch(l){const e=l;Z.ZP.loading("loading..",2.5).then((()=>Z.ZP.error(e.response.data.errors[0].msg,2.5)))}},g=e=>{console.log("Failed:",e)},f=(0,l.Fl)((()=>!(i.value.username&&i.value.password))),w=(0,l.Fl)((()=>!(u.value.email&&u.value.password&&u.value.confirm&&u.value.captcha))),h=(0,l.Fl)((()=>!(c.value.email&&c.value.password&&c.value.username&&c.value.captcha))),b=()=>{n.value=!1,console.log("finished!")},W=async e=>{if(console.log("values",e),console.log("values",m),m===u.value.captcha)if(u.value.password===u.value.confirm)try{const{data:e}=await j.Z.post("/updatepassword",{email:u.value.email,password:u.value.password});"success"===e.msg&&Z.ZP.loading("loading",1.5).then((()=>{Z.ZP.success("重置密码成功！",1.5),t.push({path:"/"})}))}catch(a){const e=a;Z.ZP.error(e.response.data.errors,1.5)}else Z.ZP.error("两次输入的密码不一致",1.5);else Z.ZP.error("验证码错误",1.3)},_=async e=>{if(console.log("values",e),console.log("values",m),m===c.value.captcha)try{const{data:e}=await j.Z.post("/register",{email:c.value.email,username:c.value.username,password:c.value.password});"success"===e.msg&&Z.ZP.loading("loading",1.5).then((()=>{Z.ZP.success("注册成功！",2)})).then((()=>{o.value="login"}))}catch(a){const e=a;Z.ZP.error(e.response.data,1.5)}else Z.ZP.error("验证码错误",1.3)},P=async e=>{if("forget"===e)if(u.value.email)try{const{data:e}=await j.Z.post("http://localhost:3000/getCaptcha",{email:u.value.email,type:"修改密码"});m=e.captcha,d.value=Date.now()+30240,n.value=!0}catch(a){const e=a;Z.ZP.error(e.response.data.errors,1.5)}else Z.ZP.error("请先输入邮箱",1.2);else if("register"===e)if(c.value.email)try{const{data:e}=await j.Z.post("http://localhost:3000/getCaptcha",{email:c.value.email,type:"注册账号"});m=e.captcha,d.value=Date.now()+30240,n.value=!0}catch(a){const e=a;Z.ZP.error(e.response.data.errors,1.5)}else Z.ZP.error("请先输入邮箱",1.2)};return(e,a)=>{const t=(0,l.up)("a-input"),m=(0,l.up)("a-form-item"),S=(0,l.up)("a-input-password"),O=(0,l.up)("a-checkbox"),k=(0,l.up)("a-button"),Z=(0,l.up)("a-form"),j=(0,l.up)("a-statistic-countdown"),x=(0,l.up)("a-input-search");return(0,l.wg)(),(0,l.iD)("div",F,[(0,l._)("div",q,[z,(0,l._)("div",C,["login"===(0,r.SU)(o)?((0,l.wg)(),(0,l.iD)("div",H,[(0,l.Wm)(Z,{model:i.value,name:"normal_login",style:{width:"50%",margin:"50% auto 0 auto"},class:"login-form",onFinish:v,onFinishFailed:g},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{label:"账户：",name:"username",rules:[{required:!0,message:"Please input your username!"}]},{default:(0,l.w5)((()=>[(0,l.Wm)(t,{value:i.value.username,"onUpdate:value":a[0]||(a[0]=e=>i.value.username=e)},{prefix:(0,l.w5)((()=>[(0,l.Wm)((0,r.SU)(p),{class:"site-form-item-icon"})])),_:1},8,["value"])])),_:1}),(0,l.Wm)(m,{label:"密码：",name:"password",rules:[{required:!0,message:"Please input your password!"}]},{default:(0,l.w5)((()=>[(0,l.Wm)(S,{value:i.value.password,"onUpdate:value":a[1]||(a[1]=e=>i.value.password=e)},{prefix:(0,l.w5)((()=>[(0,l.Wm)((0,r.SU)(y),{class:"site-form-item-icon"})])),_:1},8,["value"])])),_:1}),(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Wm)(m,{name:"remember","no-style":""},{default:(0,l.w5)((()=>[(0,l.Wm)(O,{checked:i.value.remember,"onUpdate:checked":a[2]||(a[2]=e=>i.value.remember=e),style:{"margin-right":"50px"}},{default:(0,l.w5)((()=>[(0,l.Uk)("记住我")])),_:1},8,["checked"])])),_:1}),(0,l._)("a",{class:"login-form-forgot",onClick:a[3]||(a[3]=e=>(0,r.dq)(o)?o.value="forget":o="forget"),style:{"margin-left":"70px"}},"忘记密码")])),_:1}),(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Wm)(k,{disabled:f.value,type:"primary",style:{"margin-right":"20px"},"html-type":"submit",class:"login-form-button"},{default:(0,l.w5)((()=>[(0,l.Uk)(" 登录 ")])),_:1},8,["disabled"]),(0,l.Wm)(k,{type:"primary",onClick:a[4]||(a[4]=e=>(0,r.dq)(o)?o.value="register":o="register"),style:{"margin-left":"20px"}},{default:(0,l.w5)((()=>[(0,l.Uk)(" 注册 ")])),_:1})])),_:1})])),_:1},8,["model"])])):"forget"===(0,r.SU)(o)?((0,l.wg)(),(0,l.iD)("div",D,[(0,l.Wm)(Z,{model:u.value,name:"normal_login",style:{width:"50%",margin:"50% auto 0 auto"},class:"login-form",onFinish:W,onFinishFailed:g},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{label:"邮箱：",name:"email",rules:[{required:!0,message:"Please input your email!"}]},{default:(0,l.w5)((()=>[(0,l.Wm)(t,{value:u.value.email,"onUpdate:value":a[5]||(a[5]=e=>u.value.email=e)},{prefix:(0,l.w5)((()=>[(0,l.Wm)((0,r.SU)(U),{class:"site-form-item-icon"})])),_:1},8,["value"])])),_:1}),(0,l.Wm)(m,{label:"验证码：",name:"captcha",rules:[{required:!0,message:"Please input your captcha!"}]},{default:(0,l.w5)((()=>[(0,l.Wm)(x,{value:u.value.captcha,"onUpdate:value":a[7]||(a[7]=e=>u.value.captcha=e),size:"middle"},{enterButton:(0,l.w5)((()=>[(0,l.Wm)(k,{disabled:!u.value.email},{default:(0,l.w5)((()=>[(0,l.wy)((0,l.Wm)(j,{valueStyle:{fontSize:"12px"},value:d.value,onFinish:b,format:"s 秒"},null,8,["value"]),[[s.F8,(0,r.SU)(n)]]),(0,l.wy)((0,l._)("span",{onClick:a[6]||(a[6]=e=>P("forget"))},"获取验证码",512),[[s.F8,!(0,r.SU)(n)]])])),_:1},8,["disabled"])])),_:1},8,["value"])])),_:1}),(0,l.Wm)(m,{label:"密码：",name:"password",rules:[{required:!0,message:"Please input your password!"}]},{default:(0,l.w5)((()=>[(0,l.Wm)(S,{value:u.value.password,"onUpdate:value":a[8]||(a[8]=e=>u.value.password=e)},{prefix:(0,l.w5)((()=>[(0,l.Wm)((0,r.SU)(y),{class:"site-form-item-icon"})])),_:1},8,["value"])])),_:1}),(0,l.Wm)(m,{label:"确认密码：",name:"confirm",rules:[{required:!0,message:"Please input your password again!"}]},{default:(0,l.w5)((()=>[(0,l.Wm)(S,{value:u.value.confirm,"onUpdate:value":a[9]||(a[9]=e=>u.value.confirm=e)},{prefix:(0,l.w5)((()=>[(0,l.Wm)((0,r.SU)(y),{class:"site-form-item-icon"})])),_:1},8,["value"])])),_:1}),(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Wm)(k,{style:{"margin-right":"20px"},class:"login-form-button",onClick:a[10]||(a[10]=e=>(0,r.dq)(o)?o.value="login":o="login")},{default:(0,l.w5)((()=>[(0,l.Uk)(" 返回 ")])),_:1}),(0,l.Wm)(k,{type:"primary",disabled:w.value,style:{"margin-left":"20px"},"html-type":"submit"},{default:(0,l.w5)((()=>[(0,l.Uk)(" 确认 ")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["model"])])):((0,l.wg)(),(0,l.iD)("div",M,[(0,l.Wm)(Z,{model:c.value,name:"normal_login",style:{width:"50%",margin:"50% auto 0 auto"},class:"login-form",onFinish:_,onFinishFailed:g},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{label:"邮箱：",name:"email",rules:[{required:!0,message:"Please input your email!"}]},{default:(0,l.w5)((()=>[(0,l.Wm)(t,{value:c.value.email,"onUpdate:value":a[11]||(a[11]=e=>c.value.email=e)},{prefix:(0,l.w5)((()=>[(0,l.Wm)((0,r.SU)(U),{class:"site-form-item-icon"})])),_:1},8,["value"])])),_:1}),(0,l.Wm)(m,{label:"验证码：",name:"captcha",rules:[{required:!0,message:"Please input your captcha!"}]},{default:(0,l.w5)((()=>[(0,l.Wm)(x,{value:c.value.captcha,"onUpdate:value":a[13]||(a[13]=e=>c.value.captcha=e),size:"middle"},{enterButton:(0,l.w5)((()=>[(0,l.Wm)(k,{disabled:!c.value.email},{default:(0,l.w5)((()=>[(0,l.wy)((0,l.Wm)(j,{valueStyle:{fontSize:"12px"},value:d.value,onFinish:b,format:"s 秒"},null,8,["value"]),[[s.F8,(0,r.SU)(n)]]),(0,l.wy)((0,l._)("span",{onClick:a[12]||(a[12]=e=>P("register"))},"获取验证码",512),[[s.F8,!(0,r.SU)(n)]])])),_:1},8,["disabled"])])),_:1},8,["value"])])),_:1}),(0,l.Wm)(m,{label:"账户：",name:"username",rules:[{required:!0,message:"Please input your username!"}]},{default:(0,l.w5)((()=>[(0,l.Wm)(t,{value:c.value.username,"onUpdate:value":a[14]||(a[14]=e=>c.value.username=e)},{prefix:(0,l.w5)((()=>[(0,l.Wm)((0,r.SU)(p),{class:"site-form-item-icon"})])),_:1},8,["value"])])),_:1}),(0,l.Wm)(m,{label:"密码：",name:"password",rules:[{required:!0,message:"Please input your password!"}]},{default:(0,l.w5)((()=>[(0,l.Wm)(S,{value:c.value.password,"onUpdate:value":a[15]||(a[15]=e=>c.value.password=e)},{prefix:(0,l.w5)((()=>[(0,l.Wm)((0,r.SU)(y),{class:"site-form-item-icon"})])),_:1},8,["value"])])),_:1}),(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Wm)(k,{style:{"margin-right":"20px"},class:"login-form-button",onClick:a[16]||(a[16]=e=>(0,r.dq)(o)?o.value="login":o="login")},{default:(0,l.w5)((()=>[(0,l.Uk)(" 返回 ")])),_:1}),(0,l.Wm)(k,{type:"primary",disabled:h.value,style:{"margin-left":"20px"},"html-type":"submit"},{default:(0,l.w5)((()=>[(0,l.Uk)(" 注册 ")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["model"])]))])])])}}}),N=t(89);const V=(0,N.Z)(I,[["__scopeId","data-v-2b6eff96"]]);var L=V}}]);
//# sourceMappingURL=225.c1289cfa.js.map